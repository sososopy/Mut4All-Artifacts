Issue Title:
Assertion `!RefExpr.isInvalid() && Context.hasSameType(((Expr*) RefExpr.get())->getType(), ParamType.getUnqualifiedType())' failed

Source Code & Bug Trace:
clang: /home/eschnett/SIMFACTORY/llvm-3.4.2/src/llvm-3.4.2.src/tools/clang/lib/Sema/SemaTemplate.cpp:5121: clang::ExprResult clang::Sema::BuildExpressionFromDeclTemplateArgument(const clang::TemplateArgument&, clang::QualType, clang::SourceLocation): Assertion `!RefExpr.isInvalid() && Context.hasSameType(((Expr*) RefExpr.get())->getType(), ParamType.getUnqualifiedType())' failed.

clang::Sema::DeduceTemplateArguments(clang::ClassTemplatePartialSpecializationDecl*, clang::TemplateArgumentList const&, clang::sema::TemplateDeductionInfo&) + 788
12 clang           0x0000000000d6cc94 clang::Sema::InstantiateClassTemplateSpecialization(clang::SourceLocation, clang::ClassTemplateSpecializationDecl*, clang::TemplateSpecializationKind, bool) + 676
13 clang           0x0000000000d970c6 clang::Sema::RequireCompleteTypeImpl(clang::SourceLocation, clang::QualType, clang::Sema::TypeDiagnoser&) + 1414


Bug Labels:
bugzilla, clang:frontend, crash-on-invalid