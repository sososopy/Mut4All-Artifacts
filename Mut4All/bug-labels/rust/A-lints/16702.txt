Issue Title:
Lints added with add_lint to the crate object itself are not processed · Issue #16702 · rust-lang/rust · GitHub

Rust Code:
// crate_lint.rs
#![feature(phase, plugin_registrar)]
#![crate_type = "dylib"]

extern crate syntax;
#[phase(plugin, link)] extern crate rustc;

use syntax::ast;
use rustc::plugin::Registry;
use rustc::lint::{Context, LintArray, LintPass};

#[plugin_registrar]
pub fn plugin_registrar(reg: &mut Registry) {
    reg.register_lint_pass(box CrateTest);
}

declare_lint! { CRATE_TEST, Warn, "..." }

struct CrateTest;

impl LintPass for CrateTest {
    fn get_lints(&self) -> LintArray {
        lint_array!(CRATE_TEST)
    }

    fn check_crate(&mut self, cx: &Context, krate: &ast::Crate) {
        cx.sess().add_lint(CRATE_TEST, ast::CRATE_NODE_ID, krate.span, "test".to_string());
        // cx.span_lint(CRATE_TEST, krate.span, "test");
    }
}

Bug Labels:
A-lints, A-plugins, I-ICE
