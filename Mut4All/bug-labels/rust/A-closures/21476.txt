Issue Title:
ICE when using nested associated types + generics + unboxed closures · Issue #21476 · rust-lang/rust · GitHub

Rust Code:
#![feature(unboxed_closures)]

struct Wrapper<T>(T);
struct WriterTo<T>(*mut T);

impl<T> FnMut(&[u8]) -> usize for WriterTo<T> {
    extern "rust-call" fn call_mut(&mut self, (buf,): (&[u8],)) -> usize {
        18
    }
}

trait WriteStream {
   type Writer: FnMut(&[u8]) -> usize;

   fn on_write<W: FnMut(&mut Self::Writer)>(self, W);
}

impl<T> WriteStream for Wrapper<T> {
   type Writer = WriterTo<T>;

   fn on_write<W: FnMut(&mut WriterTo<T>)>(self, listener: W) {}
}

fn main() {}

Bug Labels:
A-associated-items, A-closures, I-ICE
