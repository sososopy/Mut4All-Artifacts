Issue Title:
Compiler crashes when pretty-printing something · Issue #17824 · rust-lang/rust · GitHub

Rust Code:
use std::os;
use std::io::fs::File;

fn main() {
    let homedir = os::homedir().expect("the user's home directory could not be determined");
    let configFile = homedir.join(".cf").join("config.json");
    if (!configFile.is_file()) {
        fail!("the config file was not present at {}", configFile.display());
    }
    let mut reader = File::open(&configFile);
    let mut reader2 = reader.unwrap();
}

Bug Labels:
A-pretty, E-needs-test, I-ICE
