Issue Title:
Using impl Trait with closure local functions across crates results in ICE · Issue #43135 · rust-lang/rust · GitHub

Rust Code:
pub fn foo2() -> impl Future<Item=String, Error=()> {
    future::ok(()).and_then(|()| {
        fn msg() -> String { format!("Hello, {}!", "world") }
        future::ok(msg())
    })
}

Bug Labels:
A-impl-trait, C-bug, E-needs-test, I-ICE
