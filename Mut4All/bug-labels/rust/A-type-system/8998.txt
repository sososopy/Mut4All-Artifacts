Issue Title:
ICE in typeck subst · Issue #8998 · rust-lang/rust · GitHub

Rust Code:
extern mod extra;

mod g {
    use extra::treemap::TreeMap;

    struct LF<T> { o: ~[T] }

    fn step<T>(rules: &[T]) -> Option<LF<T>> { None }

    fn f<T:Clone+Eq+Ord+TotalOrd>(t:&T) {
        let rules : TreeMap<T, ~[T]> = TreeMap::new();
        let LF { o: _ } = step(rules.get(t)).unwrap();
    }
}

fn main() { }

Bug Labels:
A-type-system, I-ICE
