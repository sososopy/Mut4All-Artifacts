Issue Title:
3 "broken MIR" ICEs when combining futures and assoc. types · Issue #61320 · rust-lang/rust · GitHub

Rust Code:
use futures::{Future, IntoFuture};

struct Request<T>(T);

trait RequestContext {}
impl<T> RequestContext for T {}
struct NoContext;
impl AsRef<NoContext> for NoContext {
    fn as_ref(&self) -> &Self { &NoContext }
}

type BoxedError = Box<dyn ::std::error::Error + Send + Sync>;
type DefaultFuture<T, E> = Box<dyn Future<Item=T, Error=E> + Send>;

trait Guard: Sized {
    type Result: IntoFuture<Item = Self, Error = BoxedError>;
    fn from_request(
        request: &Request<()>, 
    ) -> Self::Result;
}

trait FromRequest: Sized {
    type Context;
    type Future: Future<Item = Self, Error = BoxedError> + Send;
    fn from_request(
        request: Request<()>, 
    ) -> Self::Future;
}

struct MyGuard;
impl Guard for MyGuard {
    type Result = Result<Self, BoxedError>;
    fn from_request(_request: &Request<()>) -> Self::Result {
        Ok(MyGuard)
    }
}

struct Generic<I> {
    _inner: I,
}

impl<I> FromRequest for Generic<I>
where
    MyGuard: Guard,
    <MyGuard as Guard>::Result:
        futures::IntoFuture<Item = MyGuard, Error = BoxedError>,
    <<MyGuard as Guard>::Result as futures::IntoFuture>::Future:
        Send,
    I: FromRequest<Context = NoContext>
{
    type Future = DefaultFuture<Self, BoxedError>;
    type Context = NoContext;
    fn from_request(
        headers: Request<()>,
    ) -> DefaultFuture<Self, BoxedError> {
        let _future = <MyGuard as Guard>::from_request(&headers)
            .into_future()
            .and_then(move |_| {
                <I as FromRequest>::from_request(headers)
                    .into_future()
                    .and_then(move |fld_inner| {
                        Ok(Generic {
                            _inner: fld_inner,
                        })
                        .into_future()
                    })
            });
        panic!();
    }
}

Bug Labels:
A-MIR, A-associated-items, C-bug, I-ICE, T-compiler
