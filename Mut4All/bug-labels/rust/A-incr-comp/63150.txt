Issue Title:
incremental compilation DepNode Bug running cargo check · Issue #63150 · rust-lang/rust · GitHub

Rust Code:
type Data = Vec<u8>;

#[derive(Debug)]
enum EventImpl{
    NoteOn(u8),
    NoteOff(u8)
}
#[derive(Debug)]
struct Event{
    data:Data,
    i:EventImpl
}

impl Event{
    fn new(data:Data)->Self{
        Event{
            i: match data[0]{
                0 => EventImpl::NoteOn(data[1]),
                1 => EventImpl::NoteOff(data[1]),
                _ => panic!("unk")
            },
            data:data
        }
    }
    
    fn data(&self)->&Data{
        &self.data
    }
}
type Seq = Vec<Event>;

impl PartialEq for Seq{
    fn eq(&self,o:&Self)->bool{
    // i have to learn the iterator implementation    
        let r=o.len()==self.len();
        if ! r{
            return false;
        }
        for i in 0..o.len() {
            r = r && o[i]==self[i];
        }
        r
    }
}

fn main() {
    let mut s:Seq=vec![Event::new(vec![1,2,3])];
    s.push(Event::new(vec![0,1,2]));
    let mut s2:Seq=vec![Event::new(vec![1,2,3]),Event::new(vec![0,1,2])];

    println!("Hello, world! {:?} {:?}",s, s[1].data());
    println!("S1 == S2 ? {}",s==s2);
}

Bug Labels:
A-incr-comp, C-bug, E-needs-mcve, I-ICE, P-high, T-compiler
