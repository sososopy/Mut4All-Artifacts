Issue Title:
ICE when using macro to wrap const generic · Issue #130589 · rust-lang/rust · GitHub

Rust Code:
macro_rules! wrap {
    ($v:expr) => {
        $v
    };
}

pub struct Const<const V: usize>;

pub struct S<const V: usize>(Const<{ wrap!(V) }>);

Bug Trace:
error: internal compiler error: /rustc/f79a912d9edc3ad4db910c0e93672ed5c65133fa/compiler/rustc_middle/src/hir/mod.rs:170:32: No HirId for DefId(0:11 ~ playground[5fdf]::S::0::{constant#0})

thread 'rustc' panicked at /rustc/f79a912d9edc3ad4db910c0e93672ed5c65133fa/compiler/rustc_middle/src/hir/mod.rs:170:32:
Box<dyn Any>
stack backtrace:
   0:     0x7f6efde499ea - <std::sys::backtrace::BacktraceLock::print::DisplayBacktrace as core::fmt::Display>::fmt::h1b3310dbb5ee661c
   1:     0x7f6efe5e0397 - core::fmt::write::h2e91e7fdc18a62a9
   2:     0x7f6eff4e26b3 - std::io::Write::write_fmt::h7194e331b91c164f
   3:     0x7f6efde49842 - std::sys::backtrace::BacktraceLock::print::h13e0307805a2728a
   4:     0x7f6efde4bfc1 - std::panicking::default_hook::{{closure}}::h7d72f45f0b8d37ba
   5:     0x7f6efde4bdf4 - std::panicking::default_hook::hb51e5761ac1da411
   6:     0x7f6efcf509af - std[e9c67048b9712eef]::panicking::update_hook::<alloc[b9c20340eac04ac5]::boxed::Box<rustc_driver_impl[b35071b4838aa4fe]::install_ice_hook::{closure#0}>>::{closure#0}
   7:     0x7f6efde4c6d8 - std::panicking::rust_panic_with_hook::hc348b3b9816f332a
   8:     0x7f6efcf8a7d1 - std[e9c67048b9712eef]::panicking::begin_panic::<rustc_errors[eaccfe8d10eb1271]::ExplicitBug>::{closure#0}
   9:     0x7f6efcf7d876 - std[e9c67048b9712eef]::sys::backtrace::__rust_end_short_backtrace::<std[e9c67048b9712eef]::panicking::begin_panic<rustc_errors[eaccfe8d10eb1271]::ExplicitBug>::{closure#0}, !>
  10:     0x7f6efcf7d839 - std[e9c67048b9712eef]::panicking::begin_panic::<rustc_errors[eaccfe8d10eb1271]::ExplicitBug>
  11:     0x7f6efcf93c71 - <rustc_errors[eaccfe8d10eb1271]::diagnostic::BugAbort as rustc_errors[eaccfe8d10eb1271]::diagnostic::EmissionGuarantee>::emit_producing_guarantee
  12:     0x7f6efd5adee4 - rustc_middle[7e129bc9902f6f42]::util::bug::opt_span_bug_fmt::<rustc_span[c50e6de3bd7de2f5]::span_encoding::Span>::{closure#0}
  13:     0x7f6efd5939da - rustc_middle[7e129bc9902f6f42]::ty::context::tls::with_opt::<rustc_middle[7e129bc9902f6f42]::util::bug::opt_span_bug_fmt<rustc_span[c50e6de3bd7de2f5]::span_encoding::Span>::{closure#0}, !>::{closure#0}
  14:     0x7f6efd59386b - rustc_middle[7e129bc9902f6f42]::ty::context::tls::with_context_opt::<rustc_middle[7e129bc9902f6f42]::ty::context::tls::with_opt<rustc_middle[7e129bc9902f6f42]::util::bug::opt_span_bug_fmt<rustc_span[c50e6de3bd7de2f5]::span_encoding::Span>::{closure#0}, !>::{closure#0}, !>
  15:     0x7f6efab4b830 - rustc_middle[7e129bc9902f6f42]::util::bug::bug_fmt
  16:     0x7f6efe9bf666 - rustc_query_impl[4f70052afc7e8236]::plumbing::__rust_begin_short_backtrace::<rustc_query_impl[4f70052afc7e8236]::query_impl::local_def_id_to_hir_id::dynamic_query::{closure#2}::{closure#0}, rustc_middle[7e129bc9902f6f42]::query::erase::Erased<[u8; 8usize]>>
  17:     0x7f6efe9bedde - rustc_query_system[c48e7ffdf36b68b1]::query::plumbing::try_execute_query::<rustc_query_impl[4f70052afc7e8236]::DynamicConfig<rustc_query_system[c48e7ffdf36b68b1]::query::caches::VecCache<rustc_span[c50e6de3bd7de2f5]::def_id::LocalDefId, rustc_middle[7e129bc9902f6f42]::query::erase::Erased<[u8; 8usize]>>, false, false, false>, rustc_query_impl[4f70052afc7e8236]::plumbing::QueryCtxt, false>
  18:     0x7f6efe9be90f - rustc_query_impl[4f70052afc7e8236]::query_impl::local_def_id_to_hir_id::get_query_non_incr::__rust_end_short_backtrace
  19:     0x7f6efe611ee5 - <rustc_middle[7e129bc9902f6f42]::hir::provide::{closure#4} as core[13a37436f01e0f51]::ops::function::FnOnce<(rustc_middle[7e129bc9902f6f42]::ty::context::TyCtxt, rustc_span[c50e6de3bd7de2f5]::def_id::LocalDefId)>>::call_once
  20:     0x7f6efe6110bb - rustc_query_impl[4f70052afc7e8236]::plumbing::__rust_begin_short_backtrace::<rustc_query_impl[4f70052afc7e8236]::query_impl::def_span::dynamic_query::{closure#2}::{closure#0}, rustc_middle[7e129bc9902f6f42]::query::erase::Erased<[u8; 8usize]>>
  21:     0x7f6efe60f5ae - rustc_query_system[c48e7ffdf36b68b1]::query::plumbing::try_execute_query::<rustc_query_impl[4f70052afc7e8236]::DynamicConfig<rustc_query_system[c48e7ffdf36b68b1]::query::caches::DefIdCache<rustc_middle[7e129bc9902f6f42]::query::erase::Erased<[u8; 8usize]>>, false, false, false>, rustc_query_impl[4f70052afc7e8236]::plumbing::QueryCtxt, false>
  22:     0x7f6efe60f22b - rustc_query_impl[4f70052afc7e8236]::query_impl::def_span::get_query_non_incr::__rust_end_short_backtrace
  23:     0x7f6efe98287c - <rustc_metadata[cee692af458ec028]::rmeta::encoder::EncodeContext>::encode_def_ids
  24:     0x7f6efef9e123 - <rustc_metadata[cee692af458ec028]::rmeta::encoder::EncodeContext>::encode_crate_root
  25:     0x7f6eff6d6e93 - rustc_metadata[cee692af458ec028]::rmeta::encoder::encode_metadata
  26:     0x7f6eff6df314 - rustc_metadata[cee692af458ec028]::fs::encode_and_write_metadata
  27:     0x7f6eff6de103 - <rustc_interface[28613f665859d41]::queries::Linker>::codegen_and_build_linker
  28:     0x7f6eff312d4b - rustc_interface[28613f665859d41]::interface::run_compiler::<core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>, rustc_driver_impl[b35071b4838aa4fe]::run_compiler::{closure#0}>::{closure#1}
  29:     0x7f6eff3b3550 - std[e9c67048b9712eef]::sys::backtrace::__rust_begin_short_backtrace::<rustc_interface[28613f665859d41]::util::run_in_thread_with_globals<rustc_interface[28613f665859d41]::util::run_in_thread_pool_with_globals<rustc_interface[28613f665859d41]::interface::run_compiler<core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>, rustc_driver_impl[b35071b4838aa4fe]::run_compiler::{closure#0}>::{closure#1}, core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>>::{closure#0}, core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>>::{closure#0}::{closure#0}, core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>>
  30:     0x7f6eff3b3bba - <<std[e9c67048b9712eef]::thread::Builder>::spawn_unchecked_<rustc_interface[28613f665859d41]::util::run_in_thread_with_globals<rustc_interface[28613f665859d41]::util::run_in_thread_pool_with_globals<rustc_interface[28613f665859d41]::interface::run_compiler<core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>, rustc_driver_impl[b35071b4838aa4fe]::run_compiler::{closure#0}>::{closure#1}, core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>>::{closure#0}, core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>>::{closure#0}::{closure#0}, core[13a37436f01e0f51]::result::Result<(), rustc_span[c50e6de3bd7de2f5]::ErrorGuaranteed>>::{closure#1} as core[13a37436f01e0f51]::ops::function::FnOnce<()>>::call_once::{shim:vtable#0}
  31:     0x7f6eff3b3fab - std::sys::pal::unix::thread::Thread::new::thread_start::hbddf7ad4b4e86b9c
  32:     0x7f6ef99ae609 - start_thread
  33:     0x7f6ef98d3353 - clone
  34:                0x0 - <unknown>

query stack during panic:
#0 [local_def_id_to_hir_id] getting HIR ID of `S::0::{constant#0}`
#1 [def_span] looking up span for `S::0::{constant#0}`
end of query stack
error: could not compile `playground` (lib)

Bug Labels:
A-const-generics, A-macros, C-bug, I-ICE, S-has-bisection, S-has-mcve, T-compiler
