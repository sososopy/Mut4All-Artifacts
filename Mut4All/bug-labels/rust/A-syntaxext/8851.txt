Issue Title:
ICE with name conflict in macro · Issue #8851 · rust-lang/rust · GitHub

Rust Code:
enum T {
        A(int),
        B(float)
}

macro_rules! test(
        ($e:expr) => (
                fn foo(t:T) -> int {
                        match t {
                                A(y) => $e,
                                B(y) => $e
                        }
                }
        )
)

test!(10 + (y as int))

fn main() {
        foo(A(20));
}

Bug Labels:
A-syntaxext, E-needs-test, I-ICE
