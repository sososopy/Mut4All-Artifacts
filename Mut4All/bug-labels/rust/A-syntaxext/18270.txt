Issue Title:
"internal compiler error: tried to pop without a push" when trying to use an undefined macro inside an impl block · Issue #18270 · rust-lang/rust · GitHub

Rust Code:
#![feature(macro_rules)]

impl Foo {
    test!()
}

fn main() {}

Bug Labels:
A-syntaxext, I-ICE
